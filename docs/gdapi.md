# gdapi (Go, cgo-free)

Minimal REST API service with file-backed dictionaries (TSV/JSON) and no UI. Pure Go (stdlib only).

## Build

```bash
cd /home/sagerenn/github.com/sagerenn/mdict
CGO_ENABLED=0 go build ./cmd/gdapi
```

## Run

```bash
./gdapi
# or
./gdapi -config ./configs/gdapi.json
```

## Endpoints

- `GET /health` -> `{ "status": "ok", "time": "..." }`
- `GET /dicts` -> list of dictionaries
- `GET /lookup?q=word&dict=optional,ids&limit=20` -> definitions per dictionary
- `GET /prefix?q=pre&dict=optional,ids&limit=20` -> word suggestions
- `GET /search?q=term&dict=optional,ids&limit=20` -> substring search
- `GET /debug/vars` -> expvar metrics (requests/responses)
- OpenAPI spec: `docs/openapi.yaml`

## Config

`configs/gdapi.json` uses JSON with nanosecond durations:

```json
{
  "listen": ":8080",
  "read_timeout": 5000000000,
  "write_timeout": 30000000000,
  "shutdown_timeout": 10000000000,
  "log": { "level": "info" },
  "dictionaries": [
    {
      "id": "sample",
      "name": "Sample Dictionary",
      "type": "tsv",
      "path": "./data/sample.tsv",
      "delimiter": "\t",
      "case_fold": true
    }
  ]
}
```

## Notes

- `type` can be `tsv`, `json`, `dsl`, `stardict` (`.ifo`), or `mdict` (`.mdx`). If empty, the loader uses file extension.
- `case_fold` enables lowercasing for case-insensitive lookups.
- File-backed dictionaries build a `.gdapi.idx` cache next to the source for faster reloads.
- `mdict` support currently targets MDX files generated by engine version 2.0 (as required by the decoder library).
